{% extends 'base.html' %}
{% import 'macros.html' as macros %}

{% block head %}
<title>Notebook Generator | Upload</title>
{% endblock %}

{% block content %}

<div class="container">
	<div class="row">
		<div class="col-8 large mt-5 pl-4">Upload Data<sup><i class="fa fa-question-circle small ml-1 text-muted cursor-pointer" data-toggle="collapse" data-target="#info"></i></sup></div>
		<div class="col-4 text-right mt-5">
			<button class="btn btn-primary black border-black bg-white nodecoration mr-2" onclick="goBack();"><i class="fa fa-angle-left mr-2"></i>Back</button>
			<button class="btn btn-primary navigate black border-black bg-white nodecoration" form="upload-expression-form" type="submit" formaction="{{ url_for('upload_table') }}" formmethod="post" disabled="true">Continue<i class="fa fa-angle-right ml-2"></i></button>
		</div>
	</div>
	<div class="row">
		<hr width="100%" class="mt-3 mb-0">
		<div class="col-12 px-4">

			<!-- Add introduction -->
			<div id="info" class="text-justify collapse px-2">
				<div class="mt-4 light">Here you can submit your own <b>RNA-seq dataset</b> for analysis with BioJupies.</div>
				<div class="mt-3 light">The dataset submission tool currently accepts <b>gene expression tables</b> with genes on the rows, samples on the columns, and <span class="font-italic">raw RNA-seq read counts</span> as values. Click the Example button to try some example dataset.</div>
				<div class="mt-3 light"></div>
				<div class="mt-3 light tiny text-muted"><b>Note:</b> The dataset submission tool is optimized for analysis of gene expression quantified <b>raw RNA-seq readcounts</b>. The tool will also accept normalized RNA-seq and microarray datasets; however, <span class="font-italic">the analysis tools are not optimized for the analysis of such data, so the results will not be optimal.</span></div>
				<div class="pt-4 pb-2">
					<hr width="100%" class="my-0">
				</div>
			</div>

			<!-- Expression Table Dropzone -->
			<div class="medium regular mt-4 mb-2">Upload Expression File</div>
			<div id="intro" class="very-small light mb-3">To start, upload your <b>RNA-seq expression dataset</b> using the form below.</div>
			<div id="dropzone" class="dropzone border-grey rounded" style="background-image: url({{ url_for('static', filename='img/dropzone/expression_table.png') }}); background-size: 100% 100%;"></div>
			<form id="upload-expression-form"><input type="hidden" id="expression" name="expression" value=""></form>
			<div id="preview" class="mt-2"></div>

			<!-- Formats and Examples -->
			<div id="formats" class="mt-2 tiny light pl-1">
				Supported formats: <span class="font-italic">.txt, .csv, .tsv, .xls, .xlsx</span>.
				<a href="{{ url_for('static', filename='data/example.txt') }}" class="btn bg-white border-black black nodecoration tiny regular my-auto float-right" download>Example</a>
			</div>
		</div>
	</div>
</div>

{% endblock %}


{% block footer %}

<script type="text/javascript">

$("#dropzone").dropzone({ 
	// dictDefaultMessage: "Click h",
	url: "{{ url_for('upload_dataframe_api') }}",
    success: function(file, response){

    	// Save data
        $('#expression').val(response);

    	// Parse response
    	response = JSON.parse(response);

        // Toggle Interfaces
        $('button[form="upload-expression-form"]').prop('disabled', false);
        $('#dropzone').hide();
        $('#formats').hide();
        addPreviewTable(response, true);
        $('#intro').html('The uploaded dataset contains <span class="highlight">'+response['columns'].length+' samples</span> and <span class="highlight">'+response['index'].length+' genes</span>. Check that the preview below is correct, then click Continue to proceed.')
    }
});

</script>

{% endblock %}
